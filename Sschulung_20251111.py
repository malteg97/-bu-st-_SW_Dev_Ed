# generated by mBlock5 for CyberPi
# codes make you happy

import event, time, cyberpi, mbot2

Batterie = 0
speed = 0
flash_duration = 0
active = 0
distance = 0
Pr_C3_BCfintervall = 0
rotation = 0

@event.is_press('middle')
def is_joy_press():
    global Batterie, speed, flash_duration, active
    if active == 0:
      active = 1
      mbot2.forward(speed)

    else:
      active = 0
      mbot2.forward(0)

@event.is_press('a')
def is_btn_press():
    global Batterie, speed, flash_duration, active
    speed = 50
    cyberpi.console.println("SLOWMODE")

@event.is_press('b')
def is_btn_press1():
    global Batterie, speed, flash_duration, active
    speed = 100
    cyberpi.console.println("SPEEDMODE")


@event.is_anticlockwise
def on_is_anticlockwise():
    global flash_duration
    cyberpi.led.off("all")
    for count in range(3):
      cyberpi.led.on(255, 187, 2, 1)
      time.sleep(flash_duration)
      cyberpi.led.on(0, 0, 0, 1)
      cyberpi.led.off(1)
      time.sleep(float(flash_duration))

@event.is_clockwise
def on_is_clockwise1():
    global flash_duration
    cyberpi.led.off("all")
    for count2 in range(3):
      cyberpi.led.on(255, 196, 2, 5)
      time.sleep(flash_duration)
      cyberpi.led.on(0, 0, 0, 5)
      cyberpi.led.off(5)
      time.sleep(float(flash_duration))

@event.start
def on_start():
    global Batterie, speed, flash_duration, active, distance, Pr_C3_BCfintervall, rotation
    cyberpi.console.set_font(12)
    cyberpi.console.println(cyberpi.get_battery())
    cyberpi.console.println("Tempo bestimmen")
    cyberpi.console.println("A: Langsam oder B: schnell")
    speed = 0
    flash_duration = 0.5
    active = 0
    cyberpi.console.println("Druecke den Joystick ein um zu starten.")
    distance = 20
    rotation = 0
    Pr_C3_BCfintervall = 2
    speed = 50
    while True:
      mbot2.forward(50)
      if mbuild.ultrasonic2.get(1) < distance:
        mbot2.turn(90)
        rotation = rotation + 90
        mbot2.forward(50)
        time.sleep(float(Pr_C3_BCfintervall))
        mbot2.motor_stop("all")
        mbot2.turn(-90)
        rotation = rotation + -90
        if mbuild.ultrasonic2.get(1) < distance:
          mbot2.turn(90)
          rotation = rotation + 90
          mbot2.motor_set(speed,"all")

        else:
          mbot2.motor_set(speed,"all")

        if mbuild.ultrasonic2.get(1) < distance:
          mbot2.motor_stop("all")
          mbot2.turn(-180)
          rotation = rotation + -180
          mbot2.motor_set(speed,"all")

